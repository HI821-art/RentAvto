{% extends "_layout.html" %}

{% block content %}
<div class="container mt-5" style="max-width: 600px;">
    <div class="card shadow">
        <div class="card-header bg-primary text-white">
            <h2 class="mb-0" style="font-size:1.5rem;">–û—Ñ–æ—Ä–º–ª–µ–Ω–Ω—è –æ—Ä–µ–Ω–¥–∏ –∞–≤—Ç–æ</h2>
        </div>
        <div class="card-body">
            
            <div class="alert alert-primary mb-3">
                üöó <strong>{{ selected_car.brand }} {{ selected_car.model }}</strong> ({{ selected_car.year }}) ‚Äî
                <span class="fw-bold">{{ selected_car.price_per_day }} USD/–¥–µ–Ω—å</span><br>
                <small>{{ selected_car.description }}</small>
            </div>

            
            {% if messages %}
                {% for message in messages %}
                    <div class="alert alert-danger">{{ message }}</div>
                {% endfor %}
            {% endif %}

            
            {% if booked_ranges %}
                <button class="btn btn-outline-info mb-3" type="button" data-bs-toggle="collapse" data-bs-target="#bookedDates" aria-expanded="false" aria-controls="bookedDates">
                    üìÖ –ü–æ–∫–∞–∑–∞—Ç–∏ –∑–∞–π–Ω—è—Ç—ñ –¥–∞—Ç–∏
                </button>
                <div class="collapse" id="bookedDates">
                    <div class="alert alert-info mt-2">
                        <strong>–ó–∞–π–Ω—è—Ç—ñ –¥–∞—Ç–∏:</strong>
                        <ul class="mb-0">
                            {% for r in booked_ranges %}
                                <li>{{ r.date_from }} ‚Äî {{ r.date_to }}</li>
                            {% endfor %}
                        </ul>
                    </div>
                </div>
            {% endif %}

           
            <form method="post" id="rentalForm">
                {% csrf_token %}
                {% for field in form %}
                    <div class="mb-3">
                        <label class="form-label" for="{{ field.id_for_label }}">{{ field.label }}</label>
                        {{ field }}
                        {% if field.help_text %}
                            <div class="form-text">{{ field.help_text }}</div>
                        {% endif %}
                        {% for error in field.errors %}
                            <div class="text-danger small">{{ error }}</div>
                        {% endfor %}
                    </div>
                {% endfor %}

              
                <div class="mb-3">
                    <label class="form-label">üí≥ –°–ø–æ—Å—ñ–± –æ–ø–ª–∞—Ç–∏:</label><br>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="payment_method" value="card" checked>
                        <label class="form-check-label">–ë–∞–Ω–∫—ñ–≤—Å—å–∫–∞ –∫–∞—Ä—Ç–∫–∞</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="payment_method" value="cash">
                        <label class="form-check-label">–ì–æ—Ç—ñ–≤–∫–∞ –ø—Ä–∏ –æ—Ç—Ä–∏–º–∞–Ω–Ω—ñ</label>
                    </div>
                </div>

                
                <div class="alert alert-success" id="totalPrice" style="display:none;"></div>

                <button type="submit" class="btn btn-success w-100 mt-3">–ó–∞–±—Ä–æ–Ω—é–≤–∞—Ç–∏</button>
            </form>

         
            <div class="alert alert-warning mt-4">
                üîê –í –æ—Ä–µ–Ω–¥—É –≤–∫–ª—é—á–µ–Ω–æ –±–∞–∑–æ–≤–µ —Å—Ç—Ä–∞—Ö—É–≤–∞–Ω–Ω—è —Ç–∞ –ø—ñ–¥—Ç—Ä–∏–º–∫–∞ 24/7.
            </div>
            <div class="text-muted small mt-2 text-end">
                –ù–∞—Ç–∏—Å–∫–∞—é—á–∏ ¬´–ó–∞–±—Ä–æ–Ω—é–≤–∞—Ç–∏¬ª, –≤–∏ –ø–æ–≥–æ–¥–∂—É—î—Ç–µ—Å—å –∑ <a href="#">—É–º–æ–≤–∞–º–∏ –æ—Ä–µ–Ω–¥–∏</a>.
            </div>
        </div>
    </div>
</div>


<script>
document.addEventListener('DOMContentLoaded', function () {
    const form = document.getElementById('rentalForm');
   const price = parseFloat("{{ selected_car.price_per_day|default:0 }}");
    const startField = form.querySelector('[name="date_from"]');
    const endField = form.querySelector('[name="date_to"]');
    const totalDiv = document.getElementById('totalPrice');

    function calcPrice() {
        const start = new Date(startField.value);
        const end = new Date(endField.value);
        if (!isNaN(start) && !isNaN(end) && end > start) {
            const days = Math.ceil((end - start) / (1000 * 60 * 60 * 24));
            const total = days * price;
            totalDiv.innerHTML = `üí∞ –ó–∞–≥–∞–ª—å–Ω–∞ –≤–∞—Ä—Ç—ñ—Å—Ç—å –æ—Ä–µ–Ω–¥–∏: <strong>${total} USD</strong> (${days} –¥–Ω.)`;
            totalDiv.style.display = 'block';
        } else {
            totalDiv.style.display = 'none';
        }
    }

    startField.addEventListener('change', calcPrice);
    endField.addEventListener('change', calcPrice);
});
</script>
{% endblock %}